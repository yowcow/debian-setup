---
- name: install apt packages for alacritty
  apt:
    name:
      - cmake
      - libfreetype6-dev
      - libfontconfig1-dev
      - libxcb-xfixes0-dev
      - pkg-config
      - python3

- name: check if alacritty already built
  stat:
    path: /opt/src/alacritty/target/release/alacritty
  register: stat_result

- name: build and install alacritty
  when: not stat_result.stat.exists
  vars:
    revision: v0.4.3
    src: /opt/src/alacritty
    prefix: /opt/alacritty
  block:
    - git:
        repo: https://github.com/alacritty/alacritty.git
        dest: "{{ src }}"
        version: "{{ revision }}"
    - shell:
        chdir: "{{ src }}"
        cmd: cargo build --release

- name: symlink st
  file:
    src: /opt/src/alacritty/target/release/alacritty
    dest: /usr/local/bin/alacritty
    state: link
